= Windows 11 Dev Drive Setup for .NET 8, NuGet, and JetBrains Rider
:toc:
:toclevels: 3
:sectnums:

== Purpose

This guideline describes how to configure *Windows 11 Dev Drive* for software development with:

* .NET 8 SDK
* NuGet package cache
* JetBrains Rider (IntelliJ platform)

The goals are:

* Improve IO performance for builds, restores, and indexing
* Reduce antivirus overhead during development
* Maintain acceptable security posture for developer workstations

== Dev Drive Overview

Dev Drive is optimized for developer workloads using:

* ReFS file system
* Optional Microsoft Defender performance mode (asynchronous scanning)

[WARNING]
====
Dev Drive can reduce real-time antivirus scanning. This improves performance but weakens immediate malware detection. This must align with your organization’s security policies.
====

== When to Install Developer Tools on Dev Drive

Developer tools and SDKs are typically installed in:

[cols="1,2",options="header"]
|===
|Type |Typical Location
|System-wide | `C:\Program Files\`
|Per-user | `%LOCALAPPDATA%`
|Dev Drive (optional) | `D:\dev\tools\`
|===

You may install tools and SDKs on Dev Drive if:

* Asynchronous antivirus scanning is acceptable
* Dev Drive usage is isolated to trusted development workflows
* Security-sensitive production binaries are not installed there

Recommended rule:

[quote]
____
Put source code, caches, build artifacts, and SDK toolchains on Dev Drive.  
Keep security agents and production credentials off Dev Drive.
____

== Create and Configure Dev Drive

=== Create Dev Drive (Windows UI)

. Settings -> System -> Storage -> Advanced storage settings -> Disks & volumes  
. Create a new volume  
. Select *Dev Drive (ReFS)*  
. Assign a drive letter (example: `D:`)

=== Configure Microsoft Defender Performance Mode (Optional)

By default, Dev Drive uses performance-optimized scanning.

To disable antivirus filters for all Dev Drives:

[source,powershell]
----
fsutil devdrv enable /disallowAv
----

[CAUTION]
====
This policy applies to *ALL Dev Drives* on the system.
Enable only on developer workstations and never on CI or shared machines.
====

== Recommended Folder Structure

[source]
----
D:\dev\
 ├── tools\
 │    ├── dotnet\
 │    └── rider\
 ├── nuget-cache\
 ├── projects\
 └── temp\
----

== Configure .NET 8

=== Install .NET SDK
[source]
----
./dotnet-install.ps1 -Channel LTS -InstallDir D:\tools\dotnet\
----

=== Redirect NuGet Global Packages Folder
Move to Dev Drive:

[source,powershell]
----
setx NUGET_PACKAGES "D:\nuget-cache\packages"
setx NUGET_HTTP_CACHE_PATH "D:\nuget-cache\http-cache"
setx NUGET_TEMP_PATH "D:\nuget-cache\temp"

# Verify locations (restart terminal/IDE after setx)
dotnet nuget locals all --list
----

== Configure JetBrains Rider

=== Project Location

[source]
----
D:\dev\projects\<solution>
----

=== Rider Cache Locations (Optional)

Edit:

Help -> Edit Custom Properties

[source,properties]
----
idea.system.path=D:/dev/tools/rider/system
idea.config.path=D:/dev/tools/rider/config
idea.log.path=D:/dev/tools/rider/log
----

Restart Rider.

== Package Cache (Visual Studio / Build Tools)

Visual Studio stores large caches under:

[source]
----
C:\ProgramData\Package Cache
----

If supported by your tooling, move large caches to Dev Drive.  
Restart shells or reboot after environment changes.

== Microsoft Defender Exclusions (Alternative to Disabling Filters)

Add scoped exclusions:

[source]
----
D:\dev\projects\
D:\dev\nuget-cache\
----

This is safer than disabling antivirus filters globally.

== Security Guidance

[cols="1,2",options="header"]
|===
|Area |Recommendation
|Credentials | Keep on system drive
|Secrets | Use Key Vault or environment variables
|CI agents | Do not use Dev Drive
|Production binaries | Do not store on Dev Drive
|Dev Drive content | Treat as trusted dev-only workspace
|===

== Validation Checklist

* `dotnet --info` works
* `dotnet restore` uses Dev Drive cache
* Rider opens projects from Dev Drive
* Defender behavior matches security policy
* Build times improved
* No permission issues

== Example Machine Layout

[source]
----
C:\Windows
C:\Program Files
C:\Users\<user>

D:\dev\
 ├── projects\
 ├── nuget-cache\
 ├── tools\
 └── temp\
----

== Common Pitfalls

* Disabling Defender filters on shared machines
* Storing credentials on Dev Drive
* Using Dev Drive for production artifacts
* Forgetting to restart shells after changing environment variables

== Summary

Dev Drive improves build and restore performance for .NET and JetBrains Rider by using ReFS and optimized antivirus scanning.  
Store source code, NuGet cache, and build artifacts on Dev Drive.  
Do not store secrets or production binaries.  
Carefully evaluate Defender filter settings to balance performance and security.
